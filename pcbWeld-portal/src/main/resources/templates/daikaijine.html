<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>待开发票金额</title>
<link rel="stylesheet" href="css/css.css" type="text/css">
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
</head>
<body>
	<div class="top topshow">
		<div class="main">
			<img class="fl" src="images/logo.png" alt=""/>
			<div class="fr toptxt">
				<a class="on" href="jijia.html">在线计价</a>
				<a href="shuoming.html">工艺说明</a>
				<a href="denglu.html">登录</a> |
				<a href="zhuce.html">注册</a>
			</div>
		</div>
	</div>
	
	<!--我的订单-->
	<div class="main myDD">
		<!--左侧内容-->
		<div class="fl myDDleft">
			<h3>个人中心</h3>
			<ul class="ula">
				<li><a href="">个人资料</a></li>
				<li><a href="">账号管理</a></li>
				<li><a href="">收货地址</a></li>
				<li><a href="">消息中心</a><em>15</em></li>
				<li><a href="">我的留言</a></li>
			</ul>
			<h3>我的订单</h3>
			<ul class="ulb">
				<li><a href="">资料待审核</a></li>
				<li><a href="">资料审核未通过</a></li>
				<li><a href="">待支付</a></li>
				<li><a href="">物料寄送</a></li>
				<li><a href="">物料待审核</a></li>
				<li><a href="">物料审核未通过</a></li>
				<li><a href="">待发货</a></li>
				<li><a href="">待收货</a></li>
				<li><a href="">已完成</a></li>
			</ul>
			<h3>发票管理</h3>
			<ul class="ulc">
				<li><a href="">开票信息</a></li>
				<li class="on"><a href="">待开票金额</a></li>
				<li><a href="">已开发票记录</a></li>
			</ul>
		</div>
		<!--右侧内容-->
		<div class="fr myDDright">
			<h3>待开票金额</h3>
			<div class="jinE">
				<div class="bde leijiJE">
					<p>累计待开金额：<em id="receiptAmount">￥4226.00</em></p>
					<input type="button" value="申请开票" id="createReceipt"/>
					<span>注：累计金额到达1000元以上可申请开发票</span>
				</div>
				<ul>
					<li class="headli">
						<span class="span0"><input type="checkbox"/>全选</span>
						<span class="span1">名称</span>
						<span class="span2">收货时间</span>
						<span class="span3">待开发票金额</span>
					</li>
				</ul>
			</div>
		</div>
	</div>
	
	<!--底部-->
	<div class="foot">
		<div class="main">
			<img class="fl whiteLogo" src="images/logoWhite.png" alt=""/>
			<div class="fl fotNav">
				<p><a href="jijia.html">在线计价</a><a href="shuoming.html">工艺说明</a><a href="jieshao.html">公司介绍</a></p>
				<p><span>187  1018  4327</span></p>
				<p>地址：北京市大兴区嘉悦广场5号楼</p>
			</div>
			<div class="fr public">
				<img src="images/gongzhonghao.png" alt=""/>
				<p>关注微信公众号</p>
			</div>
		</div>
	</div>
	
	<!--右侧浮条-->
	<div class="window QQ">
		<ul>
			<li class="back-to-top"><img src="images/top-1.png" alt="" title="回到顶部"/></li>
			<li><a href="tencent://message/?Site=baidu.com&uin=290933560&Menu=yes"><img src="images/top-3.png" alt="" title="QQ"/></a></li>
			<li><b><img src="images/top-5.png" alt="" title="电话"/></b><span class="tell">18710184327</span></li>
			<li><b><img src="images/top-2.png" alt="" title="微信"/></b><span class="weixin"><img width="125" height="125" src="images/gongzhonghao.png" alt="" title="微信号"/></span></li>
			<li class="close"><img src="images/top-4.png" alt="" title="关闭"/></li>
		</ul>
	</div>
	
</body>
<script type="text/javascript">
	//一件回顶部
	$(document).ready(function(){
		$(".back-to-top").click(function(event){
			event.preventDefault();
			$("html, body").animate({scrollTop:0},500);
		})
	});
	//关闭浮窗
	$(".close").click(function(){
		$(".QQ").addClass("fadeout");
	});
	//选择上传文件
	$(".change_btn").click(function () { $(".filess").click(); });
	$('.filess').change(function(){
             var file=$('.filess').val();
            $('.filetext').val(file);
         })

    /**
	 * 查询所有的订单
     */

    $.ajax({
        type : "GET",
        url : "/information/receipt/getAllOrder",
        async : false,
        success : function(data) {
            if(data){
         	   var li="";
               for(var i=0;i<data.length;i++){
               		li+= "<li>";
                    li+="<span class='span0'><input type='checkbox' name='ck'/></span>";
				    li+="<span class='span1'>"+data.orderNo+"</span>";
                    li+="<span class='span2'>"+data.createTime.Format('yyyy.MM.dd')+"</span>";
                   	li+="<span class='span3'><em>￥"+data.payAmount+"</em></span>";
				    li+="</li>";
           	 	}
           	 	$(".headli").after(li);
            }
        });
    Date.prototype.Format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "H+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

    /**
	 * 选择合适的订单开发票
     */
    var orderNo=[];
	$("[name='ck']").click(function(){
	    var totalAmount=0;
		$(":checked").each(function(){
			var orderNo = $(this).nextAll(".span1").text();
			var payAmount=$(this).nextAll(".span3").text().substr(1);
			payAmount = parseInt(payAmount);
            totalAmount+=payAmount;
			orderNo.push({'orderNo':orderNo,'payAmount':payAmount});
   		 });
		$("#receiptAmount").text("￥"+totalAmount);
    });

	$("#createReceipt").click(function(){
	    var Amount=$("#receiptAmount").text().substr(1);
		Amount =parseInt(Amount);
		if(Amount<1000){
		    alert("累计金额到达1000元以上可申请开发票");
		    return;
		}
		window.location.href="/information/receipt/createReceipt?orderNo="+JSON.stringify(orderNo)+"&Amount="+Amount;
	});
</script>

</html>
